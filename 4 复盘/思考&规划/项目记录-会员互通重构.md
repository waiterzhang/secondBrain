# 项目记录-会员互通重构

1、设计方案阶段

* 设计方案的字段内容尽可能细、不要遗漏，在会上让各方确认是否能够提供、需要这些信息；
* 考虑性能问题，对于booking主要是时长；
* 考虑顺序问题，各方间可能有顺序依赖。例如bk向torch保存授权信息，bk查报价，在bk视角两者可以并行。但是，报价在某些情况下依赖于bk保存到促销的最新信息，因此整个链路形成了一种先后顺序限制。
* 考虑最坏情况，如果新流程中的每一环失败了怎么办？会有什么影响？各方是否能接受？这个都需要确认清楚。

‍

2、自测验证

* 验证要对着prd来。

2、cr意见

* 发布时，进订的时候走新机器、下单的时候走老机器，能够保持结果符合预期？这个和开关实验的效果似乎一致。
* safe\default
* 敏感信息考虑职责范围内的安全性
* 公共依赖bolt，会不会强弱依赖之间，
* getDep强依赖，给默认值
* 支持&走，是两个概念
* 增加错误码考虑前端是否要使用，如果前端不识别，我们可能就不需要用了。
* 开关就是开关不要configSupport
* 工具方法里面不要给默认的值。
* 提前中断，不要
* qAAAA，命名不合理。
* 英文姓名校验规则要写清楚。
* 不要方法中withNull，业务中去处理这个东西。
* 工具类里面不要抛异常，Item里面是指已经远程调用完了，处理结果，不要再有远程调用。
* 上游文档不合理，要提出来。
* 已注册/未注册，这个字段在源头注释详细说明是怎么来的。
* 用处理完之后的数据
* item里面都是已经远程调用完的信息，不要在里面引入service进行远程调用。
* 异常信息里面不要给太长。
* 监控体系，新的会员互通监控vs老的会员互通监控
* 异常要有message，来表明这个错误来自于哪里。
* 会员互通密码别打印
* 总结一下，为啥有些东西在联调的时候才暴露出来。

‍

## 联调阶段

medusa要配置t值。cluster里面增加t值。

* 看看medusa。log、trans。log
* booking的tcb/raw

booking给torch中文时，booking这边是中文，torch乱码。要声明为utf-8编码。

业务上的强弱依赖和流程上的强弱依赖要区分出来。

‍

## checklist阶段

所以的非本需求的改动都要和qa同步。

新老流程切换，要想清楚影响。、

‍

‍

1、进订新流程 & 切间老流程

* 已注册、

  * 洲际 测试通过
  * 旅悦（单独授权）测试通过
  * 联合授权；测试未通过  
    1 ops_slugger_240704.215317.10.93.48.68.159062.580579085_1

    2  
    ops_slugger_240704.215517.10.93.48.68.159056.3864265551_1
  * ‍
* 未注册

  * 洲际 测试通过
  * 旅悦（单独授权）测试通过
  * 联合授权；测试通过

老流程-三种：

‍

指标记录要考虑使用场景，如何搜索

‍

‍

‍

‍

‍

‍

对一下：

* ​![image](image-20240704104020-v6b9qqg.png)​

* ​![image](image-20240704104122-2a7lupf.png)​

* ​![image](image-20240704104739-l0ux0x8.png)​

‍
