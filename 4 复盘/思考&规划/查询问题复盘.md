# 查询问题复盘

## 风控拦截复盘

**场景**

* 风控拦截突然增多；

* 14:44 由qa在群内发了出来。

* 14:48 我收到消息
* 15:07 群内回复：风控拦截，正在拉风控同学看，稍后同步结论；

​![image](image-20240229161629-phaq7ki.png)​

**问题**

* 第一时间没有看到群内的消息，这个我要重新设置一下电脑的通知；
* 核心：19分钟之后才初步排查到问题，这一点很不合格；

**复盘**

​![image](image-20240229162342-mt6vg0c.png)​

* 当时的操作：看到这个监控，不是特别熟，当时的第一反应就是点击查看trace，想看一下具体的trace。但是点开查看trace之后没有相关的trace记录。随后在系统内搜索关键词“canPass”，想看具体的记录逻辑。在具体的记录逻辑里面，我发现了这个是风控相关的操作，并非是booking本身的拦截。随后我打开了op，查看了几个trace，看起来就是风控拦截失败。
* 缺点：

  * 忽略了监控名称；监控名称里面透露了很多的信息；  
    ​![image](image-20240229164452-qbgk2mv.png)​

    监控名称里面有业务关键字段和值。本例里面就是da和canpass-false；这个很容易就知道是风控拦截问题。
  * 没有第一时间使用op工具进行精确查询，而是跑到系统里面看代码。看代码花费的时间肯定很长，op能快速的定位进订和下单的问题。而且群里面爆出来一般都是直接影响进订和下单的问题。
  * 未及时向大群内同步当前的排查结果，这样显得慢上加慢。
* 改进：

  * 看到相关监控，第一时间应该仔细的读一下监控名称。体会里面的信息。
  * 进订、下单问题及时使用op工具排查。
  * 多怀疑别人，少怀疑自己，先别怀疑自己代码有问题，因为我们出问题的概率比较小，变动也比较少。看代码太浪费时间了。
  * 及时向大群内同步相关信息。

‍

## 预售传参问题

**场景**

预售传递参数有问题，

* 14:52qa群内发出消息
* 14:57接收到信息开始排查
* 15:29回复：前端预售传参有问题xxxx

​![image](image-20240229165203-1sma6eh.png)​

**问题**

* 排查速度太慢了；过了半个多小时才有初步结论；

**复盘**

当时的操作：看到trace之后，我第一时间点进去了。当时换了新电脑，打不开qtrace，无语啊（现已解决，是浏览器自动转https的问题）！看到相关的异常我：查询参数错误。

​![image](image-20240229165704-n8r6whm.png)​

* 就很好奇，前端传了哪些参数，我第一时间没看明白。错在哪里我也没看明白。所以我在想谁给我们的错误，我去问问他，随后我去问了报价。  
  在问了之后，我去搜索了一下线上正常的查询参数是啥样的，发现prodcutid都是一些看起来很随机的数，由此猜测prodcutid有问题。
* 缺点：

  * 当时还是没有仔细注意到监控报警的标题。标题里面已经写明了是预售查询参数失败。
  * 当时也没有注意到使用op事实上，使用op可以更加高效的排查到问题：  
    ​![image](image-20240229170707-wzq1ggv.png)​
  * 为啥要去问报价参数为啥错误呢？我应该第一反应是找给我参数的这个人，找数据的源头而不是使用方。
  * 对于这种参数查询错误，去线上找真实的正确的数据没有问题，但是速度和操作还是太慢了。
* 改进：

  * 仔细确认错误的标题；
  * 排查工具，第一时间考虑op！
  * 想清楚数据的来源，然后找数据的提供方。

## 总结

* 仔细查看报警、错误、监控的标题，标题里面最简明扼要的提醒了最重要的方向信息；
* 排查工具首先想到op工具（酒店业务+预售业务），该工具能最快时间抽象问题；
* 首先怀疑依赖方问题！数据的来源是不是有问题，找相关方。
* 万不得已再去仔细看代码，群内的问题如果看代码效率就太慢了。先明确是哪里出了问题，在群里回复之后，再去仔细排查。

‍

‍

‍

‍

‍

‍

‍

‍

‍
