# B房间详情

构建B页房间详情

* 从Saturn获取房间详情数据中的房设数据。房间详情包括两个大的方面：

  * 入住须知:FacilityNoticeInfo
  * 房设、餐食、加床政策等：HotelRawAttrs
* 从进订上下文中获取产品信息
* 聚合报价、房设、餐食、c参、产品等信息，生成房间详情参数：

  * 获取物理房型信息（数据来自报价）；
  * 获取服务设施信息（数据来自报价）；
  * 获取发票信息（来自报价）；
  * 构建餐食信息（餐食信息来源报价）：

    * 餐食信息构建：来源于报价中的价格日历（价格日历的转换比较复杂）；
  * 获取房间确认时长文案，确认时长来源：

    * 报价中是否有“立即确认”标识？确认信息构建：

      * 报价中是否有立即确认标识？
      * 立即确认房间数量限制（来源于配置，默认5）；
      * 立减确认规则文案；（来源于配置）；
      * 赫程&携程的立即确认如果超出房间数量限制，则构建非立即确认文案；
      * 根据立即确认的标志、立即确认房间数限制、最大间数限制构建立即确认的开始间数及结束间数；
      * 组装上述数据；
      * 有版本控制。
  * 获取房型标记（亲子主题房，家庭房等，来源于：venus组装透传报价的参数）
  * 组装；
* 设置房型名称
* 设置酒店房型图片（图片来源于报价的Room信息）

  * 房间缩略图来自于配置，目前使用是默认图片。
  * 设置每张图片作者（？）、标题、url、基础url（baseUrl、缩略图？）、小图等信息
  * 最多Max（50，房间所拥有的照片数）数量的图片；
  * 设置展示用的小图（第一张）。
* 构建酒店套餐

  * 第二版（bizV>=143 && 小程序端），以下信息放入`hotelPackageGift`​​​：

    * 判断报价中的产品信息是否包括酒套且酒店套餐不空；
    * 如果酒套类型为`甩房宝酒店套餐`​​​、`新携程酒店套餐`​​​、`标准化礼盒（无早）`​​​：

      * 从报价中拿去酒套信息；
      * 提取非入住即享产品；
      * 提取入住即享产品；
      * 不支持入住即享的老版本，数据结构转换：

        * 根据No排序；
        * 将其转化到产品明细（`HotelPackageProductItem`​​​​）数据结构供前端展示（其中有读取Qconfig配置来转化酒套信息的原始内容）
        * 根据类型放入不同的容器。（“食”foodProduct、“礼盒”giftProdut）
      * 如果支持入住即享：

        * 根据不同的礼盒类型，使用不同的排序依据（no、价值），分装到不同的容器。（这里业务逻辑比较复杂，只是简短描述）
      * 根据“食”、“享”、“礼”拼装相关数据
    * 非标准化礼盒：

      * 组装数据（相比标准化礼盒，这里的组装数据简单很多）
  * 第一版，程序同上，但信息放入`hotelPackage`​这个节点，没有其它区别。“前端在同时使用两个字段判断，以后只保留hotelPackageGift。”
* 构建房设

  * 第一、二版 设施信息  touch端 和 小程序端 和 app端 && bizVersion \< 259 或 saturn数据为空。这个版本最终的房设放到`roomFloatFacilities`​这个字段。内容主要来自于报价。

    **先构建基础设施-直接外露的设施**  
    针对床型、面积、wifi、窗户这四项，如果Saturn没提供则使用报价的信息。  

    * 版本一：

      * （房间大小、有无窗户、吸烟政策来源于报价RoomInfo，加床、特殊餐食来源于saturn），具体的展示文案来自于配置文件。
      * 如果不包含（基础设施包含：无、不确定、未知）基础设施信息则不展示。
      * 设置外露设施的信息：icon、group（前端区分新老版本，v1老版该字段为空，取值topLineFacility为首行设施，取值specialFacility为特殊设置）、排序、颜色的展示文案。
    * 版本二：

      * 房间大小、床型、最大入住人数、吸烟政策、加床、窗户来自于报价；
      * 早餐、宽带、wifi、洗浴类型参考首先Saturn，否则报价。

    **再构建折叠起来的设施**

    serviceFacilities来自于报价，循环将房设信息放入list；在这个过程中，没有特别的处理。

    **房间设施后处理**

    * **有点晕，**​`**HotelBookingFacilitiesModel**`​ **、**​`**BookingFacilitiesModel**`​ **、**​`**HotelRoomFacilityInfo**`​**三者之间是什么关系？**
  * 第三版 设施信息,接入saturn微服务 使用范围：app端 bizVersion \>\= 220 && homeBizVersion \>\= 220 注意点：在saturn返回为空时，会使用roomFloatFacilities字段做兜底展示。

    这一版房设信息主要来自于saturn，数据放到`layerRoomFacilities`​这个字段。

    * 基础房型描述，列表顺序就是展示顺序。（均来自于saturn）
    * 额外房型描述，列表顺序就是展示顺序。（均来自于saturn）
    * 服务设施，列表顺序就是展示顺序。（均来自于saturn）
    * 非套餐酒店 （**判断依据来自报价**）&& saturn返回的电竞节点不为空，则设置电竞设施。
    * 设置亲子房信息。
* 构建政策与服务（不包括取消规则）

  * 第二版版控​`app端 bizVersion >= 143`​

    * 特别提示
    * 确认规则
    * 开发票的规则
  * 第一版版控​`app端 bizVersion < 143`​

    * 新版中本RN不再展示文案类取消规则和担保规则，表格取消规则数据在cancelRule中给出
    * 其他内容看起来差不多。
* 如果房型图片、房设、政策全为空，则返回空。否则正常返回。

## O页房间详情

* 与B页相比，O页构建参数如下：

  ||B|O|
  | ---------------------------| -----------------------------------| -----------------------------------|
  |发票|报价||
  |餐食|报价|订单中的报价|
  |确认规则|报价||
  |客户类型|报价|<br />|
  |wifi|优先saturn、报价兜底（床型+面积）|优先saturn、报价兜底（床型+面积）|
  |宽带|优先saturn、报价兜底||
  |洗浴|报价||
  |物理房型信息|报价|订单中的报价|
  |报价|报价|订单中的报价|
  |酒店原始信息（Saturn）|Saturn|Saturn|
  |c参|c参|请求带的c参|
  |房设（serviceFacilities）|报价|订单中的报价的QRoomPropInfo|
  |主题标签|进订参数中的porduct|订单中的TrackData|
  ||||

  ‍

‍
