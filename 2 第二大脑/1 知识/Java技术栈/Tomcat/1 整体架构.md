Tocmat能干什么？

- 对外处理连接，将收到的字节流转化为自己想要的Reqeust和Response对象；
- 对内处理Servlet，将对应的Request对应分发到对应的Servlet中。

基于此，整体的股价就分为两个部分，一个是连接器处理对外连接，一个是容器管理对内的Servlet。
![[Pasted image 20250406182954.png]]
其整体是一个Tomcat服务，一个Tomcat可以对应的多个Service。每个Service都有连接器和容器。这些对应关系体现在server.xml中

```java
<Server port="8006" shutdown="SHUTDOWN">
  <Service name="Catalina">

    <Connector port="8080" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443" />
    <Connector port="8010" protocol="AJP/1.3" redirectPort="8443" />

    <Engine name="Catalina" defaultHost="localhost">

      <Realm className="org.apache.catalina.realm.LockOutRealm">
   
        <Realm className="org.apache.catalina.realm.UserDatabaseRealm"
               resourceName="UserDatabase"/>
      </Realm>

      <Host name="localhost"  appBase="webapps"
   
      </Host>
    </Engine>
  </Service>
</Server>
```

### 连接器

对“连接”而言，少说自然有两端。一端是字节流，一端是结构化对象。所以连接器的主要功能可以分为三个部分：

- 网络通信
- 应用层协议解析
- Reqeuest、Respnse与ServletRequest/ServletRespnse对象转换。

这对应tomcat中的三个类：

- EndPoint
- Processor
- Adapter

​![[Pasted image 20250406183122.png]]​

### 一个请求所经历的过程

我们本机应用上启动了一个Tomcat，webapp下有我们部署的一个应用buxuewushu​​。我们在浏览器上输入http://localhost:8080/buxuewushu/add.do​​是如何找到对应Servlet进行处理呢？

在我们启动Tomcat的时候，连接器就会进行初始化监听所配置的端口号，这里我们配置的是8080端口对应的协议是HTTP。

- 请求发送到本机的8080端口，被在那里监听的HTTP/1.1的连接器Connector获得
- 连接器Connector将字节流转换为容器所需要的ServletRequest​​对象给同级Service​​下的容器模块Engine进行处理
- Engine获得地址http://localhost:8080/buxuewushu/add​​。匹配他下面的Host主机
- 匹配到名为localhost的Host（就算此时请求为具体的ip，没有配置相应的Host，也会交给名为localhost的Host进行处理，因为他是默认的主机）
- Host匹配到路径为/buxuewushu​​的Context，即在webapp下面找到相应的文件夹
- Context匹配到URL规则为*.do的servlet，对应为某个Servlet类
- 调用其doGet​​或者doPost​​方法
- Servlet执行完以后将对象返回给Context
- Context返回给Host
- Host返回给Engine
- Engine返回给连接器Connector
- 连接器Connector将对象解析为字节流发送给客户端