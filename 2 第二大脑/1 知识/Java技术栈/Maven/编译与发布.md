> booking是如何进行根据环境激活不同配置文件的？

项目如下

booking（父模块）  
├── pom.xml（父pom）  
├── app（子模块）  
│ ├── src  
│ │ ├── main  
│ │ │ ├── java  
│ │ │ └── resources  
│ │ └── pom.xml  
└── service（子模块）  
├── src  
│ ├── main  
│ │ ├── java  
│ │ └── resources  
└── pom.xml

## 编译

1、booking是一个多模块系统，其中由父pom来指定子模块间关系。

```java
    <modules>
        <module>service</module>
        <module>app</module>
    </modules>
```

2、编译时根据不同的环境来启用不同的配置文件。其具体细节在于hbooking继承的、公司指定的父pom：qunar-supom-generic​。在这个pom的rescouce标签下面指定了所启用的资源路径：

```java
<build>
        <resources>
            <resource>
                <directory>src/main/resources.${deploy.type}</directory>
            </resource>
            <resource>
                <directory>src/main/resources</directory>
            </resource>
        </resources>
<build>
```

注意：maven会根据资源的顺序进行加载，也就是说当有资源名称重复的时候，后面的资源会覆盖前面的资源。即：resources文件优先级>根据不同环境所启用的resouces。

具体的deploy.type指定在booking的pom中的profile中，在此指定了所有具体的取值。

```java
    <profiles>
        <profile>
            <id>betanoah</id>
            <properties>
                <deploy.type>betanoah</deploy.type>
            </properties>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
        </profile>
       	···
    </profiles>
```

资源文件夹可以通过deploy.type作为后缀名来区分不同的环境。

​![[Pasted image 20250406184142.png]]​

实际编译时，会根据所激活的文件资源路径，将其下面所有的文件都复制到类路径下面：

​![[Pasted image 20250406184155.png]]​

3、具体编译的时候在哪里指定的要激活哪个profile呢？

我司在noah环境的编译命令如下：

```java
mvn -U -V clean package dependency:tree \
    -Dverbose \
    -DoutputFile=cm_build_dependency.tree \
    -Denforcer.skip=true \
    -Denforcer.bds.deployType=beta \
    -Dbds.deployType=beta \
    -Dgit.srcRoot=http://gitlab.corp.qunar.com/qta/hbooking.git \
    -Dgit.branchName=20241008_originRoomExtendStay_FD-286254 \
    -Dmaven.test.skip=true \
    -DskipTests \
    -Dbds.username=weite.zhang \
    -T 4 \
    -DcheckDeployRelease_skip=true \
    -P betanoahrouter \
    -pl service,app \
    -am
其中：
-U: 强制 Maven 检查所有依赖的最新版本。
-V: 显示 Maven 的版本信息。
clean: 清理之前构建生成的文件。
package: 打包项目，通常是创建 JAR 或 WAR 文件。
dependency:tree: 显示项目依赖的层次结构树。
-Dverbose: 在执行 dependency:tree 时，显示依赖的详细信息。
-DoutputFile=cm_build_dependency.tree: 将 dependency:tree 的输出保存到指定的文件中。
-Denforcer.skip=true: 跳过 Maven Enforcer 插件的检查。
-Denforcer.bds.deployType=beta: 设置一个属性，可能是用于 Maven Enforcer 插件的配置。
-Dbds.deployType=beta: 设置一个自定义属性，可能用于项目构建中。
-Dgit.srcRoot=<a href="http://gitlab.corp.qunar.com/qta/hbooking">http://gitlab.corp.qunar.com/qta/hbooking</a>.git: 设置一个属性，可能用于项目中与 Git 相关的配置。
-Dgit.branchName=20241008_originRoomExtendStay_FD-286254: 设置 Git 分支名称的属性。
-Dmaven.test.skip=true: 跳过测试阶段。
-DskipTests: 同样用于跳过测试阶段，与上一个参数作用相同。
-Dbds.username=weite.zhang: 设置一个自定义属性，可能用于项目构建中。
-T 4: 使用 4 个线程并行构建项目。
-DcheckDeployRelease_skip=true: 设置一个属性，可能用于跳过某些检查或发布步骤。
-P betanoahrouter: 激活名为 betanoahrouter 的 Maven profile。
-pl service,app: 指定要构建的项目列表，仅构建 service 和 app 子模块。
-am: 也称为 --also-make，表示同时构建指定模块的依赖模块。
```

其中-P betanoahrouter指定了具体的prifle标签，也就能够拿到对应的deploy.type。

以上就完成了根据不同的环境激活不同的配置。

4、多模块之间resouces会有影响，会有所谓的覆盖、合并关系吗？

没有。多模块之间的resouces不会互相影响，各打各的包。

## 发布

1、booking实际有两个子模块：app & service，为啥系统里面只能看到app呢？在哪里指定的？

- app的pom中，指定打包形式为war；servcie中为jar。一般来讲，在tomcat中启动都是使用war包。
    
    > jar和war的区别：jar实际上就是一个比较通用的压缩包。而war是一个专门web程序而设计的包。
    

- 发布配置中指定了要发哪个模块：app  
    ​![[Pasted image 20250406184211.png]]​