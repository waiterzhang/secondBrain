# 第一章

## 第一章

1、变量可以分配哪些值？

```java
let x;                     // Declare a variable named x.

// Values can be assigned to variables with an = sign
x = 0;                     // Now the variable x has the value 0
x                          // => 0: A variable evaluates to its value.

// JavaScript supports several types of values
x = 1;                     // Numbers.
x = 0.01;                  // Numbers can be integers or reals.
x = "hello world";         // Strings of text in quotation marks.
x = 'JavaScript';          // Single quote marks also delimit strings.
x = true;                  // A Boolean value.
x = false;                 // The other Boolean value.
x = null;                  // Null is a special value that means "no value."
x = undefined;             // Undefined is another special value like null.
```

2、如何操作对象和数组。和python很像，但比python更加灵活。

```java
// 类似于pyhton里面的字典
let book = {               // Objects are enclosed in curly braces.
    topic: "JavaScript",   // The property "topic" has value "JavaScript."
    edition: 7             // The property "edition" has value 7
};                         // The curly brace marks the end of the object.

// 可以使用多种方法来访问、创建一个对象里面的成员们
book.topic                 // => "JavaScript"
book["edition"]            // => 7: another way to access property values.
book.author = "Flanagan";  // Create new properties by assignment.
book.contents = {};        // {} is an empty object with no properties.

// Conditionally access properties with ?. (ES2020):
book.contents?.ch01?.sect1 // => undefined: book.contents has no ch01 property.

//数组
let primes = [2, 3, 5, 7]; // An array of 4 values, delimited with [ and ].
primes[0]                  // => 2: the first element (index 0) of the array.
primes.length              // => 4: how many elements in the array.
primes[primes.length-1]    // => 7: the last element of the array.
primes[4] = 9;             // Add a new element by assignment.
primes[4] = 11;            // Or alter an existing element by assignment.
let empty = [];            // [] is an empty array with no elements.
empty.length               // => 0

// 数组里面也可以包含对象
let points = [             // An array with 2 elements.
    {x: 0, y: 0},          // Each element is an object.
    {x: 1, y: 1}
];
let data = {                 // An object with 2 properties
    trial1: [[1,2], [3,4]],  // The value of each property is an array.
    trial2: [[2,3], [4,5]]   // The elements of the arrays are arrays.
};
```

3、运算符 与java几乎一致

```java
// Operators act on values (the operands) to produce a new value.
// Arithmetic operators are some of the simplest:
3 + 2                      // => 5: addition
3 - 2                      // => 1: subtraction
3 * 2                      // => 6: multiplication
3 / 2                      // => 1.5: division
points[1].x - points[0].x  // => 1: more complicated operands also work
"3" + "2"                  // => "32": + adds numbers, concatenates strings

// JavaScript defines some shorthand arithmetic operators
let count = 0;             // Define a variable
count++;                   // Increment the variable
count--;                   // Decrement the variable
count += 2;                // Add 2: same as count = count + 2;
count *= 3;                // Multiply by 3: same as count = count * 3;
count                      // => 6: variable names are expressions, too.

// Equality and relational operators test whether two values are equal,
// unequal, less than, greater than, and so on. They evaluate to true or false.
let x = 2, y = 3;          // These = signs are assignment, not equality tests
x === y                    // => false: equality
x !== y                    // => true: inequality
x < y                      // => true: less-than
x <= y                     // => true: less-than or equal
x > y                      // => false: greater-than
x >= y                     // => false: greater-than or equal
"two" === "three"          // => false: the two strings are different
"two" > "three"            // => true: "tw" is alphabetically greater than "th"
false === (x > y)          // => true: false is equal to false

// Logical operators combine or invert boolean values
(x === 2) && (y === 3)     // => true: both comparisons are true. && is AND
(x > 3) || (y < 3)         // => false: neither comparison is true. || is OR
!(x === y)                 // => true: ! inverts a boolean value
```

4、函数

注意：函数也可以被“赋值”，太tm灵活了

```java
// Functions are parameterized blocks of JavaScript code that we can invoke.
function plus1(x) {        // Define a function named "plus1" with parameter "x"
    return x + 1;          // Return a value one larger than the value passed in
}                          // Functions are enclosed in curly braces

plus1(y)                   // => 4: y is 3, so this invocation returns 3+1

let square = function(x) { // Functions are values and can be assigned to vars
    return x * x;          // Compute the function's value
};                         // Semicolon marks the end of the assignment.

square(plus1(y))           // => 16: invoke two functions in one expression
```

es6中支持了箭头函数。这种简洁语法使用`=>`​将参数列表与函数体分开，因此用这种方式定义的函数被称为*箭头函数*。

```java
const plus1 = x => x + 1;   // The input x maps to the output x + 1
const square = x => x * x;  // The input x maps to the output x * x
plus1(y)                    // => 4: function invocation is the same
square(plus1(y))            // => 16
```

看一下this，这个this指向调用者

```java
let points={};
points.dist = function() { // Define a method to compute distance between points  // Second element of the "this" object
    console.log(this);//{ dist: [Function (anonymous)] }
};
points.dist() 
```

5、控制语句

```java
// JavaScript statements include conditionals and loops using the syntax
// of C, C++, Java, and other languages.
function abs(x) {          // A function to compute the absolute value.
    if (x >= 0) {          // The if statement...
        return x;          // executes this code if the comparison is true.
    }                      // This is the end of the if clause.
    else {                 // The optional else clause executes its code if
        return -x;         // the comparison is false.
    }                      // Curly braces optional when 1 statement per clause.
}                          // Note return statements nested inside if/else.
abs(-10) === abs(10)       // => true

function sum(array) {      // Compute the sum of the elements of an array
    let sum = 0;           // Start with an initial sum of 0.
    for(let x of array) {  // Loop over array, assigning each element to x.
        sum += x;          // Add the element value to the sum.
    }                      // This is the end of the loop.
    return sum;            // Return the sum.
}
sum(primes)                // => 28: sum of the first 5 primes 2+3+5+7+11

function factorial(n) {    // A function to compute factorials
    let product = 1;       // Start with a product of 1
    while(n > 1) {         // Repeat statements in {} while expr in () is true
        product *= n;      // Shortcut for product = product * n;
        n--;               // Shortcut for n = n - 1
    }                      // End of loop
    return product;        // Return the product
}
factorial(4)               // => 24: 1*4*3*2

function factorial2(n) {   // Another version using a different loop
    let i, product = 1;    // Start with 1
    for(i=2; i <= n; i++)  // Automatically increment i from 2 up to n
        product *= i;      // Do this each time. {} not needed for 1-line loops
    return product;        // Return the factorial
}
factorial2(5)              // => 120: 1*2*3*4*5
```

6、类

定义一个点，并计算该点到原点的距离

```java
class Point {              // By convention, class names are capitalized.
    constructor(x, y) {    // Constructor function to initialize new instances.
        this.x = x;        // This keyword is the new object being initialized.
        this.y = y;        // Store function arguments as object properties.
    }                      // No return is necessary in constructor functions.

    distance() {           // Method to compute distance from origin to point.
        return Math.sqrt(  // Return the square root of x² + y².
            this.x * this.x +  // this refers to the Point object on which
            this.y * this.y    // the distance method is invoked.
        );
    }
}

// Use the Point() constructor function with "new" to create Point objects
let p = new Point(1, 1);   // The geometric point (1,1).

// Now use a method of the Point object p
p.distance()               // => Math.SQRT2
```

## 词法结构

1、js支持使用Unicode字符集便携，因此可以在代码里面使用任何Unicode字符。但是为了便于移植和编辑，尽量使用ASCII支持的字符。

```java
const π = 3.14;
const sí = true;
```

还可以使用转意序列，允许使用Ascii字符编写Unicode字符。这些转义字符以\u来开头。后面要恰好跟着4个十六进制数字，或者由一道六个十六进制数字括在花括号内。虽然但是，别这样写。

```java
let café = 1; // Define a variable using a Unicode character
caf\u00e9     // => 1; access the variable using an escape sequence
caf\u{E9}     // => 1; another form of the same escape sequence
```

2、可选分号

js可以写分号，也可以不写分号。

js在解析的时候遵循一些大的原则：

* 在遇到显式的分号之前，会尽可能多的去解析你写的语句。

  例如以下语句，实际上a会输出3.

  ```java
  let a
  a
  =
  3
  console.log(a)
  ```

* 这样可能会导致一些奇怪的解释：

  ```java
  let y = x + f
  (a+b).toString()
  js它实际上是这样理解的：
  let y = x + f
  (a+b).toString()
  ```

* 有些情况下会是例如，比如遇到“终止性”的标记。

  * ```java
    return
    true;
    js会这样去解释：
    return; true;
    ```

* 类似的还有break、continue。

总结：使用严格模式，不要去省略分号。

### 类型、值、变量

1、js中的类型可以分为两类：

* 原始类型；包括数字、字符串、布尔、null、undefined。任何不在此列的都是对象类型。
* 对象类型；对象类型是一个属性集合，每个属性都有一个key和value。数组是一个特殊类型的对象。除此之外，js还定义了其他的特殊类型，set、map。regExp表示文本模式，并支持对字符串进行复杂的匹配、搜索和替换操作。Date表示日期和时间，并支持基本的日期算术。Error及其子类型表示执行js可能出现的错误。  
  js与静态语言不同之处在于函数和类不仅仅是语法的一部分：他们本身也可以是js程序可以操作的值。与任何对象类型一样，函数和类

2、内存

* js解释器执行自动垃圾回收，可以进行内存管理。当一个值不在可达时：当程序不再有任何方式饮用他的时候，解释器知道它永远不会再被使用，会被自动回收。

3、类型转换

* js可以自由的将一个类型的值转换为另一个类型的值。

  * 如果程序期望一个字符串，你给了一个数字，那么数字会被转换为字符串。
  * 如果期待使用布尔值的地方使用了非布尔值，js会进行转换。在实践中，\==已经被废弃，应该使用严格相等三个🟰，它不会进行类型转换。

4、数字

* JavaScript 使用 IEEE 754 标准定义的 64 位浮点格式表示数字，¹这意味着它可以表示大约±1.7976931348623157 × 10³⁰⁸和小约±5 × 10^(−324)的数字。大部分情况下，看起来不需要考虑数据溢出问题。
* js中的一些内置函数库：  

  ```java
  Math.pow(2,53)           // => 9007199254740992: 2 to the power 53
  Math.round(.6)           // => 1.0: round to the nearest integer
  Math.ceil(.6)            // => 1.0: round up to an integer
  Math.floor(.6)           // => 0.0: round down to an integer
  Math.abs(-5)             // => 5: absolute value
  Math.max(x,y,z)          // Return the largest argument
  Math.min(x,y,z)          // Return the smallest argument
  Math.random()            // Pseudo-random number x where 0 <= x < 1.0
  Math.PI                  // π: circumference of a circle / diameter
  Math.E                   // e: The base of the natural logarithm
  Math.sqrt(3)             // => 3**0.5: the square root of 3
  Math.pow(3, 1/3)         // => 3**(1/3): the cube root of 3
  Math.sin(0)              // Trigonometry: also Math.cos, Math.atan, etc.
  Math.log(10)             // Natural logarithm of 10
  Math.log(100)/Math.LN10  // Base 10 logarithm of 100
  Math.log(512)/Math.LN2   // Base 2 logarithm of 512
  Math.exp(3)              // Math.E cubed
  ```

注意：

* js中的算术计算不会溢出、除以0的情况下引发错误，溢出的时候结果是`Infinity`​，负数溢出则是-`Infinity`​。`Infinity`​继续计算结果仍是一个`Infinity`​（没有意义）。
* 下溢发生在数值运算的结果接近零而不是最小可表示数时。在这种情况下，JavaScript 返回 0。如果下溢发生在负数中，JavaScript 返回一个称为“负零”的特殊值。这种情况几乎不需要关注。
* 除以0不会出错，他只是返回无穷或者负无穷大。然而有一个例外，零除以零，则返回非数字的NaN。还有一些情况会返回NaN

  * 无穷大除以无穷大
  * 负数取平方根
  * 无法转换为数字的非数字操作数进行数学运算。

  总结：`Infinity`​表示无穷大，NaN表示非数字值。这些值作为Number对象的属性可用，同时也是预定义的全局变量。再次注意：

  * 非数字值具有一个不寻常的特征：它与任何其他值（包括自身）都不相等。这意味着您不能写 `x === NaN`​ 来确定变量 `x`​ 的值是否为 `NaN`​。相反，必须写 `x != x`​ 或 `Number.isNaN(x)`​。
  * ​`Number.isFinite()`​ 如果其参数是除 `NaN`​、`Infinity`​ 或 `-Infinity`​ 之外的数字，则返回 `true`​。全局函数 `isFinite()`​ 如果其参数是有限数字或可以转换为有限数字，则返回 `true`​。

5、日期

简单的时间操作：

```java
let timestamp = Date.now();  // The current time as a timestamp (a number).
let now = new Date();        // The current time as a Date object.
let ms = now.getTime();      // Convert to a millisecond timestamp.
let iso = now.toISOString(); // Convert to a string in standard format.
```

6、文本

* 使用单引号、双引号、反引号括起来的都是字符串；  

  ```javascript
  ""  // 空字符串：它没有任何字符
  'testing'
  "3.14"
  'name="myform"'
  "Wouldn't you prefer O'Reilly's book?"
  ```

* 文本中的转义：

  ```javascript
  'You\'re right, it can\'t be a quote'
  ```

* es6支持了支持带有表达式的模版字面量，使用反引号：

  ```javascript
  let name = "Bill";
  let greeting = `Hello ${ name }.`;  // greeting == "Hello Bill."
  ```
* 内置的一些文本函数：

  ```javascript
  let s = "Hello, world"; // 以一些文本开头。
  // 获取字符串的部分
  s.substring(1,4)        // => "ell": 第 2、3、4 个字符。
  s.slice(1,4)            // => "ell": 同上
  s.slice(-3)             // => "rld": 最后 3 个字符
  s.split(", ")           // => ["Hello", "world"]: 在分隔符字符串处分割
  // 搜索字符串
  s.indexOf("l")          // => 2: 第一个字母 l 的位置
  s.indexOf("l", 3)       // => 3: 第一个 "l" 在或之后 3 的位置
  s.indexOf("zz")         // => -1: s 不包含子字符串 "zz"
  s.lastIndexOf("l")      // => 10: 最后一个字母 l 的位置
  // ES6 及更高版本中的布尔搜索函数
  s.startsWith("Hell")    // => true: 字符串以这些开头
  s.endsWith("!")         // => false: s 不以此结尾
  s.includes("or")        // => true: s 包含子字符串 "or"
  // 创建字符串的修改版本
  s.replace("llo", "ya")  // => "Heya, world"
  s.toLowerCase()         // => "hello, world"
  s.toUpperCase()         // => "HELLO, WORLD"
  s.normalize()           // Unicode NFC 标准化：ES6
  s.normalize("NFD")      // NFD 标准化。也可用 "NFKC", "NFKD"
  // 检查字符串的各个（16 位）字符
  s.charAt(0)             // => "H": 第一个字符
  s.charAt(s.length-1)    // => "d": 最后一个字符
  s.charCodeAt(0)         // => 72: 指定位置的 16 位数字
  s.codePointAt(0)        // => 72: ES6，适用于大于 16 位的码点
  // ES2017 中的字符串填充函数
  "x".padStart(3)         // => "  x": 在左侧添加空格，使长度为 3
  "x".padEnd(3)           // => "x  ": 在右侧添加空格，使长度为 3
  "x".padStart(3, "*")    // => "**x": 在左侧添加星号，使长度为 3
  "x".padEnd(3, "-")      // => "x--": 在右侧添加破折号，使长度为 3
  // 修剪空格函数。trim() 是 ES5；其他是 ES2019
  " test ".trim()         // => "test": 删除开头和结尾的空格
  " test ".trimStart()    // => "test ": 删除左侧的空格。也可用 trimLeft
  " test ".trimEnd()      // => " test": 删除右侧的空格。也可用 trimRight
  // 其他字符串方法
  s.concat("!")           // => "Hello, world!": 只需使用 + 运算符
  "<>".repeat(5)          // => "<><><><><>": 连接 n 个副本。ES6
  ```

	注意，在js中字符串是不可变的。因此类似于replace实际上是返回了新的字符串。

7、布尔值

* 任何js值都可以转换为布尔值，以下值将都转换为false：

  ```javascript
  undefined
  null
  0
  -0
  NaN
  ""  // 空字符串
  ```

	其他所有值，均转换为true；

* 使用的时候应该注意这种转换：

  显示的声明非null时执行，因此如果undefined的时候会进入此分支：  

  ```javascript
  if (o !== null) ...
  ```

  而此时，任何为false的情况都不会进入此分支：

  ```javascript
  if (o !== null) ...
  ```

8、null和undefined

* ​`null`​是一个语言关键字，其值通常用于指示值的缺失。对`null`​使用`typeof`​运算符会返回字符串“object”，表明`null`​可以被视为指示“没有对象”的特殊对象值。然而，在实践中，`null`​通常被视为其自身类型的唯一成员，并且它可以用于表示数字、字符串以及对象的“无值”。
* ​`undefined`​值代表一种更深层次的缺失。它是未初始化变量的值，以及查询不存在的对象属性或数组元素的值时得到的值。`undefined`​值也是那些没有显式返回值的函数的返回值，以及没有传递参数的函数参数的值。

	null和undefined很多情况下都可以互换。==认为他们相等，三个🟰号则不认为他们相等。

大佬认为：`undefined`​表示系统级别的、意外的或类似错误的值缺失，而`null`​表示程序级别的、正常的或预期的值缺失。

9、全局对象

当js解释器启动的时候，会创建一个新的全局对象，并赋予它一组初始属性，用于定义：

* undefined、Infinitfy、Nan这样的全局常量；
* isNaN()、parsetInt、eval()这样的全局函数；
* Date()、RegExp()这样的构造函数；
* 像Math、Json这样的全局对象。

可以通过global来引用全局对象本身。

10、原始值和对象引用（类似于java）

* 原始值比较字面上的相等。
* 引用对象比较的是引用地址。

11、类型转换

类型转换有时候看起来会让人有一些惊讶：

|值|转为字符串|转为数字|转为布尔值|
| --------------------------| ------------------| ------------| ------------|
|undefined|"undefined"|NaN|false|
|null|"null"|0|false|
|true|"true"|1||
|false|"false"|0||
|""（空字符串）||0|false|
|"1.2"（非空，数值）||1.2|true|
|"one"（非空，非数字）||NaN|true|
|0|"0"||false|
|-0|"0"||false|
|1（有限的，非零）|"1"||true|
|Infinity|"Infinity"||true|
|-Infinity|"-Infinity"||true|
|NaN|"NaN"||false|
|{}（任何对象）|见 §3.9.3|见 §3.9.3|true|
|[]（空数组）|""|0|true|
|[9]（一个数值元素）|"9"|9|true|
|['a']（任何其他数组）|使用 join() 方法|NaN|true|
|function(){}（任何函数）|见 §3.9.3|NaN|true|

12、变量声明和赋值

* let用于定义变量
* const用于定义常量

以上两者的作用域都是“块”，简单的来讲就是花括号之内的位置。（与Java一致）如果一个声明出现在顶层，不在任何代码块，则称之为全局变量。

注意：在同一个块中声明使用let、const声明相同的名称是错误的。在嵌套作用域中声明相同的变量是合法的（但别这样做）。

```javascript
const x = 1;        // 将 x 声明为全局常量
if (x === 1) {
    let x = 2;      // 在一个块内，x 可能指向不同的值
    console.log(x); // 打印 2
}
console.log(x);     // 打印 1：我们现在回到了全局范围
let x = 3;          // 错误！尝试重新声明 x 的语法错误
```

* es6之前声明变量只有var：

  * var没有块级作用域。它们的作用域是包含函数的主题，无论它们在函数中嵌套的有多深。
  * 如果在函数外部声明使用var，他会声明一个全局变量。
  * var声明的全局变量与使用let、const声明的全局变量不同。使用var，可以使用全局对象globalThis来引用，但此时创建的属性不能被delete删除。而使用let、const创建的全局变量不是全局对象的属性。
  * 使用var可以多次声明同一个变量。
  * var会导致“提升”。var声明变量的时候，声明会被提升到封闭函数的顶部，变量的初始化仍在编写的位置，但函数的定义移到了函数的顶部。因此，你可以var变量可以在函数的任何地方使用，而不会出错。如果初始化代码没有运行，则可能是一个undefined。这是错误深藏的导火索。

13、使用未声明的变量

* 严格模式中，使用未声明的变量，在代码运行时会得到一个错误。在非严格模式下，会创建一个新的全局变量。
* 解构/赋值：

  * 就像看起来那样：

    ```javascript
    let [x,y] = [1,2];  // 同 let x=1, y=2
    [x,y] = [x+1,y+1];  // 同 x = x + 1, y = y + 1
    [x,y] = [y,x];      // 交换两个变量的值
    [x,y]               // => [3,2]：递增和交换的值
    ```
  * 这样在处理函数有多个返回值的时候比较好用：  

    ```javascript
    // 将[x,y]坐标转换为[r,theta]极坐标
    function toPolar(x, y) {
        return [Math.sqrt(x*x+y*y), Math.atan2(y,x)];
    }
    // 将极坐标转换为直角坐标
    function toCartesian(r, theta) {
        return [r*Math.cos(theta), r*Math.sin(theta)];
    }
    let [r,theta] = toPolar(1.0, 1.0);  // r == Math.sqrt(2); theta == Math.PI/4
    let [x,y] = toCartesian(r,theta);   // [x, y] == [1.0, 1,0]
    ```
  * for循环中也很好用：

    ```javascript
    let o = { x: 1, y: 2 }; // 我们将循环的对象
    for(const [name, value] of Object.entries(o)) {
        console.log(name, value); // 打印 "x 1" 和 "y 2"
    }
    ```
  * 如果没有对上：

    ```javascript
    let [x,y] = [1];     // x == 1; y == undefined
    [x,y] = [1,2,3];     // x == 1; y == 2
    [,x,,y] = [1,2,3,4]; // x == 2; y == 4
    ```
  * 解构实际上不需要数组，可以是任何可迭代对象：

    ```javascript
    let [first, ...rest] = "Hello"; // first == "H"; rest == ["e","l","l","o"]
    ```
  * 右侧对象，左侧会拿到对象的value：

    ```javascript
    let transparent = {r: 0.0, g: 0.0, b: 0.0, a: 1.0}; // 一个 RGBA 颜色

    let {r, g, b} = transparent;  // r == 0.0; g == 0.0; b == 0.0
    ```
